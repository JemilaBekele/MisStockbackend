generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

enum Status {
  Active
  Inactive
  Suspended
}

model User {
  id       String  @id @default(uuid()) @map("_id") @db.Char(36)
  name     String  @map("name")
  phone    String? @map("phone")
  userCode String?
  email    String  @unique
  admin    Boolean @default(false)
  password String
  branchId String?
  branch   Branch? @relation(fields: [branchId], references: [id])
  roleId   String  @db.Char(36)
  role     Role    @relation(fields: [roleId], references: [id])
  status   Status  @default(Active)
  // âœ… A user can be assigned to many shops
  shops    Shop[]  @relation("UserShops")

  // âœ… A user can be assigned to many stores
  stores                    Store[]               @relation("UserStores") // <-- Enum status field replacing isActive
  createdAt                 DateTime              @default(now()) @map("created_at")
  updatedAt                 DateTime              @updatedAt @map("updated_at")
  lastLoginAt               DateTime?             @default(now())
  Log                       Log[]
  StockLedger               StockLedger[]
  CreatorPurchase           Purchase[]            @relation(name: "creator")
  UpdatedPurchase           Purchase[]            @relation("UpdatedCheckEntrance")
  CreatedTransfer           Transfer[]            @relation("createdTransfer")
  UpdatedTransfer           Transfer[]            @relation("UpdatedTransfer")
  StockCorrection           StockCorrection[]     @relation("createdStockCorrection")
  UpdateStockCorrection     StockCorrection[]     @relation("updatedStockCorrection")
  Sell                      Sell[]                @relation("CreatedSale")
  UpdateSell                Sell[]                @relation("UpdatedSale")
  SellStockCorrection       SellStockCorrection[] @relation("createdSellStockCorrection")
  UpdateSellStockCorrection SellStockCorrection[] @relation("updatedSellStockCorrection")
  AllAddToCart              AddToCart[]
  CreatedAddToCart          AddToCart[]           @relation("CreatedCart")
  AddToCart                 AddToCart[]           @relation("UpdatedCart")
  waitlists                 Waitlist[]
  waitlistsCreated          Waitlist[]            @relation("CreatedWaitlist")
  waitlistsUpdated          Waitlist[]            @relation("UpdatedWaitlist")

  @@map("users")
}

model Role {
  id          String           @id @default(uuid()) @map("_id") @db.Char(36)
  name        String           @unique @db.VarChar(100)
  description String?
  createdAt   DateTime         @default(now())
  updatedAt   DateTime         @updatedAt
  permissions RolePermission[]
  users       User[]
}

model Permission {
  id          String           @id @default(uuid()) @map("_id") @db.Char(36)
  name        String           @unique @db.VarChar(100)
  description String?
  createdAt   DateTime         @default(now())
  updatedAt   DateTime         @updatedAt
  roles       RolePermission[]
}

model RolePermission {
  id           String     @id @default(uuid()) @map("_id") @db.Char(36)
  roleId       String     @db.Char(36)
  permissionId String     @db.Char(36)
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt
  permission   Permission @relation(fields: [permissionId], references: [id])
  role         Role       @relation(fields: [roleId], references: [id])

  @@unique([roleId, permissionId])
}

model Company {
  id          String   @id @default(uuid()) @map("_id") @db.Char(36)
  name        String
  email       String?  @unique
  phone       String?
  address     String? // Optional field
  description String?
  tinAddress  String?
  TIN         String?
  From        String?
  logo        String?
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  @@map("companies")
}

model Branch {
  id        String      @id @default(uuid()) @map("_id") @db.Char(36)
  name      String
  address   String?
  phone     String?     @map("phone") // e.g., +88 05454 6446
  email     String?     @map("email") // e.g., example@example.com
  createdAt DateTime    @default(now()) @map("created_at")
  updatedAt DateTime    @updatedAt @map("updated_at")
  Shop      Shop[]
  Store     Store[]
  User      User[]
  Sell      Sell[]
  AddToCart AddToCart[]
  waitlists Waitlist[]

  @@map("branches")
}

model Shop {
  id                      String                    @id @default(uuid()) @map("_id") @db.Char(36)
  name                    String
  branchId                String
  branch                  Branch                    @relation(fields: [branchId], references: [id])
  createdAt               DateTime                  @default(now()) @map("created_at")
  updatedAt               DateTime                  @updatedAt @map("updated_at")
  ShopStock               ShopStock[]
  StockLedger             StockLedger[]
  SourceTransfer          Transfer[]                @relation("TransferSourceShop")
  DestinatTransfer        Transfer[]                @relation("TransferDestinationShop")
  StockCorrection         StockCorrection[]
  AdditionalPrice         AdditionalPrice[]
  SellItem                SellItem[]
  SellStockCorrectionItem SellStockCorrectionItem[]
  User                    User[]                    @relation("UserShops")
  CartItem                CartItem[]
  waitlists               Waitlist[]
  notifications           Notification[]

  @@map("shops")
}

model Store {
  id       String @id @default(uuid()) @map("_id") @db.Char(36)
  name     String
  branchId String
  branch   Branch @relation(fields: [branchId], references: [id])

  createdAt        DateTime          @default(now()) @map("created_at")
  updatedAt        DateTime          @updatedAt @map("updated_at")
  ProductBatch     ProductBatch[]
  StoreStock       StoreStock[]
  StockLedger      StockLedger[]
  Purchase         Purchase[]
  SourceTransfer   Transfer[]        @relation("TransferSourceStore")
  DestinatTransfer Transfer[]        @relation("TransferDestinationStore")
  StockCorrection  StockCorrection[]
  User             User[]            @relation("UserStores")
  notifications    Notification[]

  @@map("stores")
}

model StoreStock {
  id       String       @id @default(uuid()) @map("_id") @db.Char(36)
  storeId  String       @db.Char(36)
  store    Store        @relation(fields: [storeId], references: [id])
  batchId  String
  batch    ProductBatch @relation(fields: [batchId], references: [id])
  quantity Int
  status   StockStatus  @default(Available)

  // âœ… Link directly to a single unit of measure
  unitOfMeasureId String
  unitOfMeasure   UnitOfMeasure @relation(fields: [unitOfMeasureId], references: [id])
  createdAt       DateTime      @default(now()) @map("created_at")
  updatedAt       DateTime      @updatedAt @map("updated_at")

  @@unique([storeId, batchId])
  @@map("store_stocks")
}

enum StockStatus {
  Available
  Reserved
  Sold
  Damaged
  Returned
  Disposed
}

model ShopStock {
  id      String       @id @default(uuid()) @map("_id") @db.Char(36)
  shopId  String       @db.Char(36)
  shop    Shop         @relation(fields: [shopId], references: [id])
  batchId String
  batch   ProductBatch @relation(fields: [batchId], references: [id])

  // âœ… Link directly to a single unit of measure
  unitOfMeasureId String
  unitOfMeasure   UnitOfMeasure @relation(fields: [unitOfMeasureId], references: [id])
  quantity        Int
  status          StockStatus   @default(Available)

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@unique([shopId, batchId])
  @@map("shop_stocks")
}

model StockLedger {
  id        String  @id @default(uuid()) @map("_id") @db.Char(36)
  invoiceNo String? @unique // Invoice number

  batchId String
  batch   ProductBatch @relation(fields: [batchId], references: [id])

  storeId String? @db.Char(36)
  store   Store?  @relation(fields: [storeId], references: [id])

  shopId String? @db.Char(36)
  shop   Shop?   @relation(fields: [shopId], references: [id])

  movementType StockMovementType
  quantity     Int

  // âœ… Link directly to a single unit of measure
  unitOfMeasureId String
  unitOfMeasure   UnitOfMeasure @relation(fields: [unitOfMeasureId], references: [id])
  reference       String? // invoice, purchase order, transfer ref
  userId          String?       @db.Char(36)
  user            User?         @relation(fields: [userId], references: [id])

  notes String?

  movementDate DateTime @default(now())
  createdAt    DateTime @default(now()) @map("created_at")
  updatedAt    DateTime @updatedAt @map("updated_at")

  @@map("stock_ledgers")
}

enum StockMovementType {
  IN // purchase, stock in
  OUT // sales, consumption
  TRANSFER // store â†’ shop, shop â†’ store
  ADJUSTMENT // manual corrections
  RETERN
}

model Log {
  id     String  @id @default(uuid()) @map("_id") @db.Char(36)
  action String  @db.VarChar(1000) // e.g., "Added 50", "Transferred 20", "Sold 5"
  userId String? @db.Char(36)
  user   User?   @relation(fields: [userId], references: [id])

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("stock_logs")
}

model Customer {
  id          String      @id @default(uuid()) @map("_id") @db.Char(36)
  name        String      @map("first_name")
  companyName String?     @db.VarChar(255)
  phone1      String      @map("phone1")
  phone2      String?     @map("phone2") // optional second phone
  tinNumber   String?     @db.VarChar(100)
  address     String?
  createdAt   DateTime    @default(now()) @map("created_at")
  updatedAt   DateTime    @updatedAt @map("updated_at")
  Sell        Sell[]
  AddToCart   AddToCart[]
  waitlists   Waitlist[]

  @@map("customers")
}

model Supplier {
  id          String     @id @default(uuid()) @map("_id") @db.Char(36)
  name        String     @db.VarChar(255)
  contactName String?    @db.VarChar(255)
  phone       String?    @db.VarChar(50)
  email       String?    @db.VarChar(255)
  address     String?
  city        String?    @db.VarChar(100)
  country     String?    @db.VarChar(100)
  tinNumber   String?    @db.VarChar(100)
  notes       String?
  createdAt   DateTime   @default(now()) @map("created_at")
  updatedAt   DateTime   @updatedAt @map("updated_at")
  Purchase    Purchase[]

  @@map("suppliers")
}

model Category {
  id   String @id @default(uuid()) @map("_id") @db.Char(36)
  name String

  products      Product[]
  subCategories SubCategory[] // ðŸ‘ˆ one-to-many relation

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("categories") // Add this line if your table is actually called 'categories'
}

model SubCategory {
  id   String @id @default(uuid()) @map("_id") @db.Char(36) // SL (serial number)
  name String // Sub category name (e.g., Vitamin, Antibiotics)

  // Relation to Category
  categoryId String
  category   Category @relation(fields: [categoryId], references: [id])

  products Product[] // Relation to products if needed

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("subcategory") // This maps to the actual table name 'subcategory'
}

model Product {
  id String @id @default(uuid()) @map("_id") @db.Char(36)

  productCode String   @unique // e.g., PRD001
  name        String
  generic     String?
  description String?
  categoryId  String
  category    Category @relation(fields: [categoryId], references: [id])

  subCategoryId String?
  subCategory   SubCategory? @relation(fields: [subCategoryId], references: [id])
  sellPrice     Decimal?     @db.Decimal(10, 2)

  imageUrl String

  // âœ… Link directly to a single unit of measure
  unitOfMeasureId String
  unitOfMeasure   UnitOfMeasure @relation(fields: [unitOfMeasureId], references: [id])

  batches  ProductBatch[] // ðŸ‘ˆ Each product can have multiple batches
  isActive Boolean        @default(true) // true = active, false = inactive

  createdAt               DateTime                  @default(now()) @map("created_at")
  updatedAt               DateTime                  @updatedAt @map("updated_at")
  PurchaseItem            PurchaseItem[]
  TransferItem            TransferItem[]
  StockCorrectionItem     StockCorrectionItem[]
  CartItem                CartItem[]
  AdditionalPrice         AdditionalPrice[]
  SellItem                SellItem[]
  SellStockCorrectionItem SellStockCorrectionItem[]
  waitlists               Waitlist[]

  @@map("products")
}

model AdditionalPrice {
  id        String  @id @default(uuid()) @map("_id") @db.Char(36)
  label     String?
  price     Float
  productId String  @db.Char(36)
  product   Product @relation(fields: [productId], references: [id])

  shopId    String?  @db.Char(36)
  shop      Shop?    @relation(fields: [shopId], references: [id])
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([productId, label])
  @@map("additional_prices")
}

model ProductBatch {
  id          String    @id @default(uuid()) @map("_id") @db.Char(36)
  batchNumber String    @unique
  expiryDate  DateTime?
  productId   String    @db.Char(36)

  price           Float?  @default(0) // Base price for this batch
  stock           Int?    @default(0)
  warningQuantity Int?    @default(0)
  // Relations
  storeId         String? @db.Char(36)
  store           Store?  @relation(fields: [storeId], references: [id])
  product         Product @relation(fields: [productId], references: [id])

  createdAt                DateTime                   @default(now())
  updatedAt                DateTime                   @updatedAt
  ShopStock                ShopStock[]
  StoreStock               StoreStock[]
  StockLedger              StockLedger[]
  PurchaseItem             PurchaseItem[]
  TransferItem             TransferItem[]
  StockCorrectionItem      StockCorrectionItem[]
  SellItemBatch            SellItemBatch[]
  SellStockCorrectionBatch SellStockCorrectionBatch[]

  @@map("product_batches")
}

model UnitOfMeasure {
  id     String  @id @default(uuid()) @map("_id") @db.Char(36)
  name   String  @unique
  symbol String?
  base   Boolean @default(false)

  // âœ… Back relation to products
  products Product[]

  PurchaseItem PurchaseItem[]

  TransferItem TransferItem[]

  StockLedger StockLedger[]

  ShopStock ShopStock[]

  StoreStock StoreStock[]

  StockCorrectionItem StockCorrectionItem[]

  SellItem SellItem[]

  SellStockCorrectionItem SellStockCorrectionItem[]

  CartItem CartItem[]

  @@map("unitofmeasure") // This maps to the actual table name 'unitofmeasure'
}

model Purchase {
  id         String   @id @default(uuid()) @map("_id") @db.Char(36)
  invoiceNo  String   @unique // Invoice number
  supplierId String   @db.Char(36)
  supplier   Supplier @relation(fields: [supplierId], references: [id])
  storeId    String   @db.Char(36)
  store      Store    @relation(fields: [storeId], references: [id])

  paymentStatus PaymentStatus @default(PENDING) // Paid, Pending, Partial, Unpaid

  totalProducts Int   @default(0) // number of different items
  subTotal      Float @default(0)
  grandTotal    Float @default(0)

  notes        String?
  purchaseDate DateTime @default(now())

  createdBy   User?   @relation(fields: [createdById], references: [id], name: "creator")
  createdById String? @db.Char(36)
  updatedById String? @db.Char(36)
  updatedBy   User?   @relation("UpdatedCheckEntrance", fields: [updatedById], references: [id])

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  items           PurchaseItem[]
  StockCorrection StockCorrection[]

  @@map("purchases")
}

model PurchaseItem {
  id         String   @id @default(uuid()) @map("_id") @db.Char(36)
  purchaseId String   @db.Char(36)
  purchase   Purchase @relation(fields: [purchaseId], references: [id])

  productId String  @db.Char(36)
  product   Product @relation(fields: [productId], references: [id])

  batchId String
  batch   ProductBatch @relation(fields: [batchId], references: [id])

  // âœ… Link directly to a single unit of measure
  unitOfMeasureId String
  unitOfMeasure   UnitOfMeasure @relation(fields: [unitOfMeasureId], references: [id])
  quantity        Int
  unitPrice       Float         @default(0)
  totalPrice      Float         @default(0)

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("purchase_items")
}

enum PaymentStatus {
  PENDING
  APPROVED
  REJECTED
}

enum TaxType {
  PERCENT
  FIXED
}

enum DiscountType {
  PERCENT
  FIXED
}

enum TransferStatus {
  PENDING
  COMPLETED
  CANCELLED
}

enum TransferEntityType {
  STORE
  SHOP
}

model Transfer {
  id        String @id @default(uuid()) @map("_id") @db.Char(36)
  shortCode String @unique // Invoice number

  // Source
  sourceType    TransferEntityType
  sourceStoreId String?            @db.Char(36)
  sourceStore   Store?             @relation("TransferSourceStore", fields: [sourceStoreId], references: [id])
  sourceShopId  String?            @db.Char(36)
  sourceShop    Shop?              @relation("TransferSourceShop", fields: [sourceShopId], references: [id])

  // Destination
  destinationType TransferEntityType
  destStoreId     String?            @db.Char(36)
  destStore       Store?             @relation("TransferDestinationStore", fields: [destStoreId], references: [id])
  destShopId      String?            @db.Char(36)
  destShop        Shop?              @relation("TransferDestinationShop", fields: [destShopId], references: [id])

  // Transfer details
  reference    String? // optional transfer reference code
  notes        String?
  status       TransferStatus @default(PENDING)
  movementDate DateTime       @default(now())

  createdById String? @db.Char(36)
  createdBy   User?   @relation("createdTransfer", fields: [createdById], references: [id])
  updatedById String? @db.Char(36)
  updatedBy   User?   @relation("UpdatedTransfer", fields: [updatedById], references: [id])

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  items           TransferItem[]
  StockCorrection StockCorrection[]

  @@map("transfers")
}

model TransferItem {
  id         String   @id @default(uuid()) @map("_id") @db.Char(36)
  transferId String   @db.Char(36)
  transfer   Transfer @relation(fields: [transferId], references: [id])

  productId String  @db.Char(36)
  product   Product @relation(fields: [productId], references: [id])

  batchId String
  batch   ProductBatch @relation(fields: [batchId], references: [id])

  // âœ… Link directly to a single unit of measure
  unitOfMeasureId String
  unitOfMeasure   UnitOfMeasure @relation(fields: [unitOfMeasureId], references: [id])

  quantity Int

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("transfer_items")
}

// ======================= ENUMS ======================= //

enum StockCorrectionReason {
  PURCHASE_ERROR
  TRANSFER_ERROR
  EXPIRED
  DAMAGED
  MANUAL_ADJUSTMENT
}

enum StockCorrectionStatus {
  PENDING
  APPROVED
  REJECTED
}

model StockCorrection {
  id        String @id @default(uuid()) @map("_id") @db.Char(36)
  shortCode String @unique // Invoice number

  storeId String? @db.Char(36)
  store   Store?  @relation(fields: [storeId], references: [id])

  shopId String? @db.Char(36)
  shop   Shop?   @relation(fields: [shopId], references: [id])

  // correction details
  reason StockCorrectionReason
  status StockCorrectionStatus @default(PENDING)

  // optional linkage to original source document
  purchaseId String?   @db.Char(36)
  purchase   Purchase? @relation(fields: [purchaseId], references: [id])

  transferId String?   @db.Char(36)
  transfer   Transfer? @relation(fields: [transferId], references: [id])

  reference String? // Optional reference number for tracking
  notes     String?

  createdById String? @db.Char(36)
  createdBy   User?   @relation("createdStockCorrection", fields: [createdById], references: [id])
  updatedById String? @db.Char(36)
  updatedBy   User?   @relation("updatedStockCorrection", fields: [updatedById], references: [id])

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  items StockCorrectionItem[]

  @@map("stock_corrections")
}

model StockCorrectionItem {
  id           String          @id @default(uuid()) @map("_id") @db.Char(36)
  correctionId String          @db.Char(36)
  correction   StockCorrection @relation(fields: [correctionId], references: [id])

  productId String  @db.Char(36)
  product   Product @relation(fields: [productId], references: [id])

  batchId String?
  batch   ProductBatch? @relation(fields: [batchId], references: [id])

  unitOfMeasureId String
  unitOfMeasure   UnitOfMeasure @relation(fields: [unitOfMeasureId], references: [id])

  quantity Int // Allow both positive and negative values

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("stock_correction_items")
}

enum SaleStatus {
  NOT_APPROVED
  PARTIALLY_DELIVERED
  APPROVED
  DELIVERED
  CANCELLED
}

model Sell {
  id         String     @id @default(uuid()) @map("_id") @db.Char(36)
  invoiceNo  String     @unique
  saleStatus SaleStatus @default(NOT_APPROVED)
  locked     Boolean    @default(false)
  lockedAt   DateTime?
  branchId   String?
  branch     Branch?    @relation(fields: [branchId], references: [id])

  customerId String?   @db.Char(36)
  customer   Customer? @relation(fields: [customerId], references: [id])

  totalProducts Int   @default(0)
  subTotal      Float @default(0)
  discount      Float @default(0)
  vat           Float @default(0)
  grandTotal    Float @default(0)
  NetTotal      Float @default(0)

  notes    String?
  saleDate DateTime @default(now())

  createdById String? @db.Char(36)
  createdBy   User?   @relation("CreatedSale", fields: [createdById], references: [id])
  updatedById String? @db.Char(36)
  updatedBy   User?   @relation("UpdatedSale", fields: [updatedById], references: [id])

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  items               SellItem[]
  SellStockCorrection SellStockCorrection[]

  @@map("sells")
}

model SellItem {
  id     String @id @default(uuid()) @map("_id") @db.Char(36)
  sellId String @db.Char(36)
  sell   Sell   @relation(fields: [sellId], references: [id])

  productId String  @db.Char(36)
  product   Product @relation(fields: [productId], references: [id])

  shopId String @db.Char(36)
  shop   Shop   @relation(fields: [shopId], references: [id])

  unitOfMeasureId String
  unitOfMeasure   UnitOfMeasure @relation(fields: [unitOfMeasureId], references: [id])

  itemSaleStatus ItemSaleStatus @default(PENDING)

  quantity   Int
  unitPrice  Float @default(0)
  totalPrice Float @default(0)

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  batches SellItemBatch[]

  @@map("sell_items")
}

model SellItemBatch {
  id         String   @id @default(uuid()) @map("_id") @db.Char(36)
  sellItemId String   @db.Char(36)
  sellItem   SellItem @relation(fields: [sellItemId], references: [id])

  batchId String       @db.Char(36)
  batch   ProductBatch @relation(fields: [batchId], references: [id])

  quantity Int @default(0) // Quantity taken from this batch

  @@unique([sellItemId, batchId])
  @@map("sell_item_batches")
}

enum ItemSaleStatus {
  PENDING
  DELIVERED
}

// ==============================
// ðŸ›’ ADD TO CART MODELS
// ==============================

model AddToCart {
  id String @id @default(uuid()) @map("_id") @db.Char(36)

  userId String @db.Char(36)
  user   User   @relation(fields: [userId], references: [id])

  branchId     String?
  branch       Branch? @relation(fields: [branchId], references: [id])
  isCheckedOut Boolean @default(false) // true when converted into a Sell

  customerId  String?   @db.Char(36)
  customer    Customer? @relation(fields: [customerId], references: [id])
  totalItems  Int       @default(0)
  totalAmount Float     @default(0)

  createdById String?  @db.Char(36)
  createdBy   User?    @relation("CreatedCart", fields: [createdById], references: [id])
  updatedById String?  @db.Char(36)
  updatedBy   User?    @relation("UpdatedCart", fields: [updatedById], references: [id])
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  items     CartItem[]
  waitlists Waitlist[]

  @@map("add_to_carts")
}

model CartItem {
  id     String    @id @default(uuid()) @map("_id") @db.Char(36)
  cartId String    @db.Char(36)
  cart   AddToCart @relation(fields: [cartId], references: [id])

  shopId String @db.Char(36)
  shop   Shop   @relation(fields: [shopId], references: [id]) // ðŸ†• Added shop relation

  productId String
  product   Product @relation(fields: [productId], references: [id])

  unitOfMeasureId String?
  unitOfMeasure   UnitOfMeasure? @relation(fields: [unitOfMeasureId], references: [id])

  quantity   Int
  unitPrice  Float @default(0)
  totalPrice Float @default(0)

  notes String?

  createdAt DateTime   @default(now()) @map("created_at")
  updatedAt DateTime   @updatedAt @map("updated_at")
  waitlists Waitlist[]

  @@map("cart_items")
}

model Waitlist {
  id String @id @default(uuid()) @map("_id") @db.Char(36)

  userId String? @db.Char(36)
  user   User?   @relation(fields: [userId], references: [id])

  customerId String?   @db.Char(36)
  customer   Customer? @relation(fields: [customerId], references: [id])

  branchId String? @db.Char(36)
  branch   Branch? @relation(fields: [branchId], references: [id])

  // Links to the cart this waitlist belongs to
  cartId String?    @db.Char(36)
  cart   AddToCart? @relation(fields: [cartId], references: [id])

  // Optional: link to a specific CartItem being waitlisted
  cartItemId String?   @db.Char(36)
  cartItem   CartItem? @relation(fields: [cartItemId], references: [id])

  productId String?  @db.Char(36)
  product   Product? @relation(fields: [productId], references: [id])

  quantity Int     @default(1)
  note     String?
  shopId   String? @db.Char(36)
  shop     Shop?   @relation(fields: [shopId], references: [id])

  createdById String? @db.Char(36)
  createdBy   User?   @relation("CreatedWaitlist", fields: [createdById], references: [id])
  updatedById String? @db.Char(36)
  updatedBy   User?   @relation("UpdatedWaitlist", fields: [updatedById], references: [id])

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("waitlists")
}

enum SellStockCorrectionStatus {
  PENDING
  APPROVED
  REJECTED
}

model SellStockCorrection {
  id     String  @id @default(uuid()) @map("_id") @db.Char(36)
  sellId String? @db.Char(36)
  sell   Sell?   @relation(fields: [sellId], references: [id])

  status SellStockCorrectionStatus @default(PENDING)

  reference String? // Optional reference number for tracking
  notes     String?

  createdById String?  @db.Char(36)
  createdBy   User?    @relation("createdSellStockCorrection", fields: [createdById], references: [id])
  updatedById String?  @db.Char(36)
  updatedBy   User?    @relation("updatedSellStockCorrection", fields: [updatedById], references: [id])
  total       Float    @default(0)
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  items SellStockCorrectionItem[]

  @@map("sell_stock_corrections")
}

model SellStockCorrectionItem {
  id String @id @default(uuid()) @map("_id") @db.Char(36)

  correctionId String              @db.Char(36)
  correction   SellStockCorrection @relation(fields: [correctionId], references: [id])

  productId String  @db.Char(36)
  product   Product @relation(fields: [productId], references: [id])

  shopId String? @db.Char(36)
  shop   Shop?   @relation(fields: [shopId], references: [id])

  unitOfMeasureId String        @db.Char(36)
  unitOfMeasure   UnitOfMeasure @relation(fields: [unitOfMeasureId], references: [id])

  quantity   Int // Can be positive or negative
  unitPrice  Float @default(0)
  totalPrice Float @default(0)

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  batches SellStockCorrectionBatch[]

  @@map("sell_stock_correction_items")
}

model SellStockCorrectionBatch {
  id String @id @default(uuid()) @map("_id") @db.Char(36)

  correctionItemId String                  @db.Char(36)
  correctionItem   SellStockCorrectionItem @relation(fields: [correctionItemId], references: [id])

  batchId String       @db.Char(36)
  batch   ProductBatch @relation(fields: [batchId], references: [id])

  quantity Int @default(0)

  @@unique([correctionItemId, batchId])
  @@map("sell_stock_correction_batches")
}

model Notification {
  id                String             @id @default(uuid()) @map("_id") @db.Char(36)
  title             String
  message           String
  type              NotificationType
  read              Boolean            @default(false)
  relatedEntityType RelatedEntityType?
  relatedEntityId   String?            @db.Char(36)
  createdAt         DateTime           @default(now()) @map("created_at")
  readAt            DateTime?          @map("read_at")
  storeId           String?            @db.Char(36)
  store             Store?             @relation(fields: [storeId], references: [id])

  shopId String? @db.Char(36)
  shop   Shop?   @relation(fields: [shopId], references: [id])

  @@index([read])
  @@map("notifications")
}

enum DocumentType {
  CONTRACT
  CV
  REPORT
  CERTIFICATE
  ID_CARD
  PASSPORT
  LICENSE
  OTHER
  Lease
}

enum NotificationType {
  SELL_READY_FOR_DELIVERY
  SELL_CANCELLED

  Payment
  Inventory
  System
  Approval
}

enum RelatedEntityType {
  SELL
  MaintenanceRequest
  Invoice
  PurchaseOrder
  InventoryRequest
}
